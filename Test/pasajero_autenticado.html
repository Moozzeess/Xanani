<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Xanani - Pasajero</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        slate: { 850: '#1e293b', 900: '#0f172a' }
                    },
                    animation: {
                        'ping-slow': 'ping 2s cubic-bezier(0, 0, 0.2, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        /* Estilos para simular el dispositivo */
        body {
            background-color: #111827;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            font-family: sans-serif;
        }

        main {
            height: 100vh;
            width: 100vw;
            position: relative;
        }

        /* Mapa Leaflet ocupando todo el fondo */
        #map {
            width: 100%;
            height: 100%;
            z-index: 0;
            background: #e5e7eb; /* Fallback */
        }

        /* Ocultar atribución para limpieza visual en demo */
        .leaflet-control-attribution { display: none; }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }

        /* ESTILOS DE MARCADORES */
        .bus-marker-container {
            transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
            filter: drop-shadow(0 10px 8px rgb(0 0 0 / 0.04));
        }
        .bus-marker-container:hover {
            transform: scale(1.2) translateY(-5px);
            z-index: 1000 !important;
        }
        
        /* Animación de pulso suave para SOS */
        .marker-pulse {
            animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;
        }
        @keyframes ping {
            75%, 100% { transform: scale(1.5); opacity: 0; }
        }
    </style>
</head>

<body>

    <!-- CONTENIDO DE LA APP -->
    <main class="flex flex-col h-screen w-screen relative bg-slate-200">

        <!-- HEADER FLOTANTE -->
        <div class="fixed top-0 left-0 right-0 px-5 top-4 pb-4 flex justify-between items-center z-[500] pointer-events-none">
            <div class="bg-white/90 backdrop-blur p-2 rounded-full shadow-lg pointer-events-auto flex items-center gap-2 pr-4 mt-2 border border-white/50">
                <div class="w-8 h-8 bg-slate-900 rounded-full flex items-center justify-center text-white font-bold text-xs">U</div>
                <div class="flex flex-col leading-none">
                        <span class="text-[9px] font-bold text-gray-400 uppercase">Hola</span>
                        <span class="text-xs font-bold text-slate-800">Pasajero</span>
                </div>
            </div>
        </div>

        <!-- MAPA LEAFLET -->
        <div class="flex-1 relative w-full h-full overflow-hidden">
            <div id="map"></div>
            
            <!-- BOTÓN DE ALERTA FLOTANTE -->
            <button onclick="openReportModal()" class="fixed bottom-24 right-6 z-[500] group cursor-pointer active:scale-95 transition-transform drop-shadow-2xl">
                <div class="relative w-16 h-16 bg-white rounded-2xl shadow-xl flex items-center justify-center border border-slate-100">
                    <div class="absolute inset-0 bg-yellow-400 rounded-2xl opacity-0 group-hover:opacity-20 transition-opacity"></div>
                    <i data-lucide="triangle-alert" class="w-8 h-8 text-yellow-500 fill-yellow-100"></i>
                </div>
            </button>
        </div>

        <!-- BOTTOM NAVIGATION BAR -->
        <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-slate-200 z-[1000] shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
            <div class="flex justify-between items-center h-16 px-4 max-w-md mx-auto">
                <button class="text-slate-900 flex flex-col items-center gap-1 w-14">
                    <i data-lucide="map" class="w-6 h-6 stroke-[2.5]"></i>
                    <span class="text-[10px] font-bold">Mapa</span>
                </button>
                
                <button class="text-slate-400 hover:text-slate-600 flex flex-col items-center gap-1 w-14">
                    <i data-lucide="clock" class="w-6 h-6"></i>
                    <span class="text-[10px] font-medium">Historial</span>
                </button>

                <div class="relative -top-5">
                    <button class="w-14 h-14 bg-blue-600 rounded-2xl rotate-45 flex items-center justify-center text-white shadow-lg shadow-blue-600/40 active:scale-95 transition-all border-4 border-white">
                        <i data-lucide="navigation" class="w-6 h-6 -rotate-45"></i>
                    </button>
                </div>

                <button class="text-slate-400 hover:text-slate-600 flex flex-col items-center gap-1 w-14">
                    <i data-lucide="user" class="w-6 h-6"></i>
                    <span class="text-[10px] font-medium">Perfil</span>
                </button>

                <button class="text-slate-400 hover:text-red-500 flex flex-col items-center gap-1 w-14">
                    <i data-lucide="log-out" class="w-6 h-6"></i>
                    <span class="text-[10px] font-medium">Salir</span>
                </button>
            </div>
            
            <div class="w-full flex justify-center pb-2">
                <div class="w-20 h-1 bg-gray-200 rounded-full"></div>
            </div>
        </div>

        <!-- BOTTOM SHEET (Detalles) -->
        <div id="vehicle-sheet" class="absolute inset-x-0 bottom-0 z-[1100] flex flex-col items-center pointer-events-none transition-transform duration-300 translate-y-full h-full justify-end">
            <div class="absolute inset-0 bg-black/30 pointer-events-auto opacity-0 transition-opacity duration-300" id="sheet-backdrop" onclick="closeSheet()"></div>
            
            <div class="w-full bg-white rounded-t-[2rem] shadow-2xl pointer-events-auto relative overflow-hidden pb-8 z-50">
                <div class="w-full flex justify-center pt-4 pb-2 cursor-pointer" onclick="closeSheet()">
                    <div class="w-12 h-1.5 bg-slate-200 rounded-full"></div>
                </div>
                <div id="sheet-content" class="px-6 pt-2 pb-6 max-h-[70vh] overflow-y-auto no-scrollbar">
                    <!-- Contenido dinámico -->
                </div>
            </div>
        </div>

        <!-- MODAL REPORTE -->
        <div id="report-modal" class="absolute inset-0 z-[1200] hidden items-center justify-center p-6 bg-black/60 backdrop-blur-sm opacity-0 transition-opacity duration-200">
            <div class="bg-white w-full rounded-2xl shadow-2xl overflow-hidden transform scale-95 transition-transform duration-200" id="report-modal-content">
                <div class="bg-[#1f1f1f] p-4 flex justify-between items-center">
                    <h3 class="text-white font-bold flex items-center gap-2 text-sm tracking-wide">
                        <i data-lucide="triangle-alert" class="text-amber-400 w-4 h-4"></i> REPORTAR
                    </h3>
                    <button onclick="closeReportModal()" class="text-gray-400 hover:text-white"><i data-lucide="x" class="w-5 h-5"></i></button>
                </div>
                <div class="p-5">
                    <p class="text-xs font-bold text-gray-400 uppercase mb-3">Tipo de incidencia</p>
                    <div class="grid grid-cols-2 gap-3 mb-4">
                        <button class="p-3 border rounded-xl hover:bg-red-50 hover:border-red-200 flex flex-col items-center gap-2 transition-colors bg-gray-50">
                            <i data-lucide="octagon-alert" class="text-red-500"></i> <span class="text-xs font-bold text-gray-700">Accidente</span>
                        </button>
                        <button class="p-3 border rounded-xl hover:bg-orange-50 hover:border-orange-200 flex flex-col items-center gap-2 transition-colors bg-gray-50">
                            <i data-lucide="clock" class="text-orange-500"></i> <span class="text-xs font-bold text-gray-700">Retraso</span>
                        </button>
                        <button class="p-3 border rounded-xl hover:bg-blue-50 hover:border-blue-200 flex flex-col items-center gap-2 transition-colors bg-gray-50">
                            <i data-lucide="trash-2" class="text-blue-500"></i> <span class="text-xs font-bold text-gray-700">Limpieza</span>
                        </button>
                        <button class="p-3 border rounded-xl hover:bg-purple-50 hover:border-purple-200 flex flex-col items-center gap-2 transition-colors bg-gray-50">
                            <i data-lucide="shield" class="text-purple-500"></i> <span class="text-xs font-bold text-gray-700">Seguridad</span>
                        </button>
                    </div>
                    <button onclick="closeReportModal()" class="w-full py-3.5 bg-[#1f1f1f] text-white rounded-xl font-bold shadow-lg active:scale-95 transition-all">Enviar Reporte</button>
                </div>
            </div>
        </div>

    </main>

    <script>
        // --- DATOS (Simulados) ---
        const vehicles = [
            { id: 1, plate: 'MX-001', status: 'En ruta',  color: 'bg-green-400', text: 'text-green-900', pillBg: 'bg-green-100 text-green-700', eta: '2 min', occ: 'Alta', pos: [19.4326, -99.1332], driver: 'Juan P.' },
            { id: 2, plate: 'MX-002', status: 'Terminal', color: 'bg-amber-400', text: 'text-amber-900', pillBg: 'bg-amber-100 text-amber-700', eta: 'En base', occ: 'Baja', pos: [19.4426, -99.1432], driver: 'Luis G.' },
            { id: 3, plate: 'MX-003', status: 'Inactivo', color: 'bg-red-500',   text: 'text-white',     pillBg: 'bg-red-100 text-red-700',   eta: 'Fuera',   occ: 'Nula', pos: [19.4226, -99.1232], driver: 'Ana R.' },
            { id: 4, plate: 'MX-004', status: 'Sin señal',color: 'bg-purple-400',text: 'text-purple-900',pillBg: 'bg-purple-100 text-purple-700',eta: 'Desc.',   occ: 'Media', pos: [19.4526, -99.1532], driver: 'Pedro' },
        ];

        let map;

        document.addEventListener('DOMContentLoaded', () => {
            initMap();
            lucide.createIcons();
        });

        // --- INICIALIZAR MAPA LEAFLET ---
        function initMap() {
            map = L.map('map', {
                attributionControl: false
            }).setView([19.4326, -99.1332], 13);

            // Capa de Mapa: CartoDB Voyager (Estilo limpio y moderno)
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png', {
                maxZoom: 19
            }).addTo(map);

            // Agregar Vehículos
            vehicles.forEach(v => {
                if(v.status === 'Inactivo') return;
                
                // SVG del bus
                const busSvg = `<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 6v6"/><path d="M15 6v6"/><path d="M2 12h19.6"/><path d="M18 18h3s.5-1.7.8-2.8c.1-.4.2-.8.2-1.2 0-.4-.1-.8-.2-1.2l-1.4-5C20.1 6.8 19.1 6 18 6H4a2 2 0 0 0-2 2v10h3"/><circle cx="7" cy="18" r="2"/><path d="M9 18h5"/><circle cx="16" cy="18" r="2"/></svg>`;
                
                const html = `
                    <div class="bus-marker-container relative w-12 h-12 flex items-center justify-center">
                        <!-- Etiqueta ETA flotante -->
                        <div class="absolute -top-6 left-1/2 -translate-x-1/2 bg-slate-900 text-white px-2 py-0.5 rounded text-[9px] font-bold shadow-md whitespace-nowrap z-20 opacity-90">
                            ${v.eta}
                        </div>
                        <!-- Fondo/Sombra decorativa -->
                        <div class="absolute inset-0 rounded-xl ${v.color} opacity-30"></div>
                        <!-- Contenedor Principal -->
                        <div class="relative w-10 h-10 ${v.color} rounded-xl border-2 border-white shadow-lg flex items-center justify-center ${v.text}">
                           ${busSvg}
                        </div>
                    </div>
                `;

                const icon = L.divIcon({
                    className: 'bg-transparent',
                    html: html,
                    iconSize: [48, 48],
                    iconAnchor: [24, 24]
                });

                const marker = L.marker(v.pos, { icon: icon }).addTo(map);
                
                // Evento Click: Abrir Bottom Sheet
                marker.on('click', () => openSheet(v));
            });
        }

        // --- UI LOGIC (Sheet & Modals) ---
        function openSheet(vehicle) {
            const sheet = document.getElementById('vehicle-sheet');
            const content = document.getElementById('sheet-content');
            const backdrop = document.getElementById('sheet-backdrop');
            
            // Generar asientos (Mock visual)
            let seatsHtml = '';
            for(let i=0; i<16; i++) {
                const occupied = i < (vehicle.occ === 'Alta' ? 14 : vehicle.occ === 'Media' ? 8 : 2);
                seatsHtml += `<div class="w-6 h-6 rounded m-0.5 flex items-center justify-center text-[8px] font-bold transition-colors ${occupied ? 'bg-slate-300 text-slate-500' : 'bg-white border border-green-500 text-green-600'}">${i+1}</div>`;
            }

            content.innerHTML = `
                <div class="flex justify-between items-start mb-5">
                    <div>
                        <h2 class="text-2xl font-bold text-slate-800 tracking-tight">${vehicle.plate}</h2>
                        <div class="flex items-center gap-1 text-sm text-gray-500 mt-0.5">
                            <i data-lucide="user" class="w-3 h-3"></i> ${vehicle.driver}
                        </div>
                    </div>
                    <span class="${vehicle.pillBg} px-3 py-1 rounded-full text-xs font-bold border border-current/10">${vehicle.status}</span>
                </div>
                
                <div class="bg-slate-50 p-4 rounded-2xl mb-6 border border-slate-100">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Disponibilidad</span>
                        <span class="text-xs font-bold text-green-600 bg-green-100 px-2 py-0.5 rounded">
                            ${vehicle.occ === 'Alta' ? '2' : vehicle.occ === 'Media' ? '8' : '14'} asientos
                        </span>
                    </div>
                    <div class="relative border-2 border-slate-200 bg-white rounded-[1.5rem] p-3 max-w-[200px] mx-auto">
                        <div class="absolute -right-3 top-1/2 -translate-y-1/2 w-4 h-12 bg-slate-100 border-r-2 border-y-2 border-slate-200 rounded-r-lg"></div>
                        <div class="grid grid-cols-4 gap-1 justify-items-center">
                            ${seatsHtml}
                        </div>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                     <button class="bg-slate-100 py-3.5 rounded-xl font-bold text-sm hover:bg-slate-200 text-slate-700 transition-colors flex items-center justify-center gap-2">
                        <i data-lucide="map-pin" class="w-4 h-4"></i> Ver Ruta
                     </button>
                     <button onclick="openReportModal()" class="bg-slate-900 text-white py-3.5 rounded-xl font-bold text-sm hover:bg-slate-800 transition-colors shadow-lg shadow-slate-900/20 flex items-center justify-center gap-2">
                        <i data-lucide="flag" class="w-4 h-4"></i> Reportar
                     </button>
                </div>
            `;
            
            sheet.classList.remove('translate-y-full');
            backdrop.classList.remove('opacity-0');
            lucide.createIcons();
        }

        function closeSheet() {
            document.getElementById('vehicle-sheet').classList.add('translate-y-full');
            document.getElementById('sheet-backdrop').classList.add('opacity-0');
        }

        function openReportModal() {
            const m = document.getElementById('report-modal');
            m.classList.remove('hidden');
            setTimeout(() => m.classList.remove('opacity-0'), 10);
            document.getElementById('report-modal-content').classList.remove('scale-95');
        }

        function closeReportModal() {
            const m = document.getElementById('report-modal');
            m.classList.add('opacity-0');
            document.getElementById('report-modal-content').classList.add('scale-95');
            setTimeout(() => m.classList.add('hidden'), 200);
        }
    
        window.addEventListener('resize', () => {
            map.invalidateSize();
        });

    </script>
</body>
</html>